
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Dokumentacja LQR Drona</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 30px;
        }
        h3 {
            color: #555;
            margin-top: 25px;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        pre code {
            background: none;
            padding: 0;
            color: #f8f8f2;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        blockquote {
            border-left: 4px solid #3498db;
            padding-left: 20px;
            color: #555;
            font-style: italic;
            margin: 20px 0;
        }
        .math {
            font-family: 'Times New Roman', serif;
            font-style: italic;
        }
        @media print {
            body {
                max-width: 100%;
                margin: 0;
            }
            h1 {
                page-break-before: always;
            }
            h1:first-child {
                page-break-before: avoid;
            }
        }
    </style>
</head>
<body>
<h1>KOMPLETNA DOKUMENTACJA MATEMATYCZNA - STEROWANIE LQR DRONA</h1>
<h2>Analiza kodu w D:\repo_git\Dron\bicopter</h2>
<hr />
<h2>âœ… POTWIERDZENIE: TWÃ“J KOD JEST FIZYCZNIE POPRAWNY!</h2>
<p>TwÃ³j model w <code>rhs.py</code> implementuje poprawnie rÃ³wnania ruchu w ukÅ‚adzie ciaÅ‚a (body frame) zgodnie z oryginaÅ‚em MATLAB.</p>
<hr />
<h1>CZÄ˜ÅšÄ† 1: MODEL FIZYCZNY</h1>
<h2>1.1 Wektor stanu</h2>
<pre class="codehilite"><code>x = [vx, vz, Ï‰, X, Z, Î¸]áµ€  (n=6)

vx, vz - prÄ™dkoÅ›ci w ukÅ‚adzie CIAÅA [m/s]
Ï‰      - prÄ™dkoÅ›Ä‡ kÄ…towa [rad/s]
X, Z   - pozycja w ukÅ‚adzie INERCJALNYM [m]
Î¸      - kÄ…t pochylenia [rad]
</code></pre>

<h2>1.2 RÃ³wnania ruchu - PEÅNE WYPROWADZENIE</h2>
<h3>RÃ³wnanie 1: dvx/dt (przyspieszenie w osi X ciaÅ‚a)</h3>
<pre class="codehilite"><code>MASSÂ·dvx/dt = âˆ’DÂ·cos(Î±) âˆ’ GÂ·sin(Î¸) âˆ’ MASSÂ·Ï‰Â·vz

dvx/dt = [âˆ’DÂ·cos(Î±) âˆ’ GÂ·sin(Î¸)]/MASS âˆ’ Ï‰Â·vz
</code></pre>

<p><strong>SkÅ‚adniki:</strong>
- <code>-DÂ·cos(Î±)</code> - opÃ³r aerodynamiczny w osi X
- <code>-GÂ·sin(Î¸)</code> - skÅ‚adowa ciÄ™Å¼aru (Î¸&gt;0 â†’ ciÄ…gnie do tyÅ‚u)
- <code>-Ï‰Â·vz</code> - <strong>wyraz Coriolisa</strong> (z obrotu ukÅ‚adu)</p>
<h3>RÃ³wnanie 2: dvz/dt (przyspieszenie w osi Z ciaÅ‚a)</h3>
<pre class="codehilite"><code>dvz/dt = [âˆ’DÂ·sin(Î±) + GÂ·cos(Î¸) âˆ’ Tâ‚ âˆ’ Tâ‚‚]/MASS + Ï‰Â·vx + az_turb
</code></pre>

<p><strong>SkÅ‚adniki:</strong>
- <code>-DÂ·sin(Î±)</code> - opÃ³r w osi Z
- <code>+GÂ·cos(Î¸)</code> - skÅ‚adowa ciÄ™Å¼aru (poziomo: peÅ‚ne G)
- <code>âˆ’Tâ‚ âˆ’ Tâ‚‚</code> - ciÄ…gi silnikÃ³w (minus bo w gÃ³rÄ™)
- <code>+Ï‰Â·vx</code> - <strong>wyraz Coriolisa</strong>
- <code>+az_turb</code> - zakÅ‚Ã³cenia</p>
<h3>RÃ³wnanie 3: dÏ‰/dt (przyspieszenie kÄ…towe)</h3>
<pre class="codehilite"><code>IyÂ·dÏ‰/dt = LÂ·(Tâ‚‚ âˆ’ Tâ‚) + CM_QÂ·Ï‰

dÏ‰/dt = [LÂ·(Tâ‚‚ âˆ’ Tâ‚) + CM_QÂ·Ï‰]/Iy
</code></pre>

<p><strong>Gdzie:</strong>
- L = MOTOR_ARM_LENGTH = 0.5 m
- CM_Q = -0.01 (tÅ‚umienie)
- Iy = 1.5625 kgÂ·mÂ²</p>
<h3>RÃ³wnania 4-5: Transformacja do ukÅ‚adu inercjalnego</h3>
<pre class="codehilite"><code>Macierz rotacji:
R(Î¸) = [cos(Î¸)   sin(Î¸) ]
       [âˆ’sin(Î¸)  cos(Î¸) ]

dX/dt = cos(Î¸)Â·vx + sin(Î¸)Â·vz
dZ/dt = âˆ’sin(Î¸)Â·vx + cos(Î¸)Â·vz
</code></pre>

<p><strong>KLUCZOWE:</strong> vx, vz sÄ… w ukÅ‚adzie ciaÅ‚a, ale X, Z w inercjalnym!</p>
<h3>RÃ³wnanie 6: dÎ¸/dt</h3>
<pre class="codehilite"><code>dÎ¸/dt = Ï‰
</code></pre>

<hr />
<h1>CZÄ˜ÅšÄ† 2: LINEARYZACJA</h1>
<h2>2.1 Po co linearyzacja?</h2>
<p><strong>Problem:</strong> RÃ³wnania sÄ… <strong>nieliniowe</strong>: <code>áº‹ = f(x,u)</code></p>
<p><strong>LQR wymaga:</strong> UkÅ‚adu <strong>liniowego</strong>: <code>áº‹ = Ax + Bu</code></p>
<p><strong>RozwiÄ…zanie:</strong> Linearyzacja w pobliÅ¼u punktu pracy!</p>
<h2>2.2 Szereg Taylora</h2>
<pre class="codehilite"><code>f(x,u) â‰ˆ f(xâ‚€,uâ‚€) + (âˆ‚f/âˆ‚x)Â·(xâˆ’xâ‚€) + (âˆ‚f/âˆ‚u)Â·(uâˆ’uâ‚€)
                     â””â”€â”€â”¬â”€â”€â”˜           â””â”€â”€â”¬â”€â”€â”˜
                        A                  B
</code></pre>

<h2>2.3 Algorytm numeryczny (matrices.py)</h2>
<pre class="codehilite"><code class="language-python">def aa_matrices_AB(RHS, x, t, u, n, m):
    Î´ = 1.0e-6  # MaÅ‚e zaburzenie

    f0 = aa_rhs(x, t, u)  # Nominalna wartoÅ›Ä‡

    # Macierz A (âˆ‚f/âˆ‚x)
    A = np.zeros((n, n))
    for j in range(n):
        dx = np.zeros(n)
        dx[j] = Î´              # Zaburz j-ty stan
        A[:, j] = (aa_rhs(x+dx, t, u) - f0) / Î´

    # Macierz B (âˆ‚f/âˆ‚u)
    B = np.zeros((n, m))
    for j in range(m):
        du = np.zeros(m)
        du[j] = Î´              # Zaburz j-te sterowanie
        B[:, j] = (aa_rhs(x, t, u+du) - f0) / Î´

    return A, B
</code></pre>

<h2>2.4 Interpretacja fizyczna</h2>
<p><strong>A[1,0] = âˆ‚(dvz/dt)/âˆ‚vx:</strong></p>
<p>Z rÃ³wnania: <code>dvz/dt = ... + Ï‰Â·vx</code></p>
<p>WiÄ™c: <code>âˆ‚(dvz/dt)/âˆ‚vx = Ï‰</code></p>
<p><strong>B[1,0] = âˆ‚(dvz/dt)/âˆ‚Tâ‚:</strong></p>
<p>Z rÃ³wnania: <code>dvz/dt = (... âˆ’ Tâ‚ âˆ’ Tâ‚‚)/MASS</code></p>
<p>WiÄ™c: <code>âˆ‚(dvz/dt)/âˆ‚Tâ‚ = âˆ’1/MASS = âˆ’0.04</code></p>
<hr />
<h1>CZÄ˜ÅšÄ† 3: TEORIA LQR</h1>
<h2>3.1 Problem optymalizacji</h2>
<p><strong>Cel:</strong> Minimalizuj</p>
<pre class="codehilite"><code>      âˆ
J = âˆ« (xáµ€Qx + uáµ€Ru) dt
    0
</code></pre>

<p><strong>Przy wiÄ™zach:</strong></p>
<pre class="codehilite"><code>áº‹ = Ax + Bu
x(0) = xâ‚€
</code></pre>

<h2>3.2 SkÅ‚adniki funkcji kosztu</h2>
<h3>xáµ€Qx - "koszt stanu"</h3>
<pre class="codehilite"><code>xáµ€Qx = qâ‚â‚Â·vxÂ² + qâ‚‚â‚‚Â·vzÂ² + qâ‚ƒâ‚ƒÂ·Ï‰Â² + qâ‚„â‚„Â·XÂ² + qâ‚…â‚…Â·ZÂ² + qâ‚†â‚†Â·Î¸Â²
</code></pre>

<p><strong>Interpretacja:</strong>
- DuÅ¼e Q[i,i] â†’ maÅ‚e odchylenia (Å›cisÅ‚a kontrola)
- MaÅ‚e Q[i,i] â†’ duÅ¼e odchylenia OK (luÅºna kontrola)</p>
<h3>uáµ€Ru - "koszt sterowania"</h3>
<pre class="codehilite"><code>uáµ€Ru = râ‚â‚Â·Tâ‚Â² + râ‚‚â‚‚Â·Tâ‚‚Â²
</code></pre>

<p><strong>Interpretacja:</strong>
- DuÅ¼e R[i,i] â†’ oszczÄ™dnoÅ›Ä‡ energii
- MaÅ‚e R[i,i] â†’ pozwala na duÅ¼e sterowania</p>
<h2>3.3 Optymalne sterowanie</h2>
<p><strong>Twierdzenie:</strong> Optymalne u ma postaÄ‡:</p>
<pre class="codehilite"><code>u*(t) = âˆ’KÂ·x(t)
</code></pre>

<p>K - macierz wzmocnieÅ„ (mÃ—n)</p>
<h2>3.4 Algebraiczne rÃ³wnanie Riccatiego (ARE)</h2>
<pre class="codehilite"><code>0 = Aáµ€S + SA âˆ’ SBRâ»Â¹Báµ€S + Q
</code></pre>

<p>S - rozwiÄ…zanie (nÃ—n, symetryczna, dodatnio okreÅ›lona)</p>
<p>Po znalezieniu S:</p>
<pre class="codehilite"><code>K = Râ»Â¹Báµ€S
</code></pre>

<hr />
<h1>CZÄ˜ÅšÄ† 4: ROZWIÄ„ZANIE RICCATIEGO - WARTOÅšCI WÅASNE</h1>
<h2>4.1 Macierz Hamiltonowska</h2>
<pre class="codehilite"><code>H = [  A      BRâ»Â¹Báµ€ ]  (2nÃ—2n)
    [  Q       âˆ’Aáµ€   ]
</code></pre>

<p><strong>Kod (lqr.py, linia 49):</strong></p>
<pre class="codehilite"><code class="language-python">hamiltonian = np.block([
    [a, b @ np.linalg.inv(r) @ b.T],
    [q, -a.T]
])
</code></pre>

<h2>4.2 Obliczenie wartoÅ›ci wÅ‚asnych</h2>
<pre class="codehilite"><code class="language-python">eigvals, eigvecs = np.linalg.eig(hamiltonian)
</code></pre>

<p>Zwraca:
- <code>eigvals</code> - 2n wartoÅ›ci wÅ‚asnych
- <code>eigvecs</code> - macierz 2nÃ—2n wektorÃ³w wÅ‚asnych</p>
<h2>4.3 KLUCZOWY KROK: Sortowanie</h2>
<p><strong>WÅ‚asnoÅ›Ä‡ H:</strong> WartoÅ›ci wÅ‚asne wystÄ™pujÄ… parami (Î», âˆ’Î»)!</p>
<pre class="codehilite"><code class="language-python">idx = np.argsort(np.real(eigvals))  # Sortuj rosnÄ…co
eigvals = eigvals[idx]
eigvecs = eigvecs[:, idx]
</code></pre>

<p><strong>Po sortowaniu:</strong></p>
<pre class="codehilite"><code>eigvals = [Î»â‚, Î»â‚‚, ..., Î»â‚™,  Î»â‚™â‚Šâ‚, ..., Î»â‚‚â‚™]
           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           Re(Î») &lt; 0         Re(Î») &gt; 0
           (stabilne)        (niestabilne)
</code></pre>

<h2>4.4 Sprawdzenie poprawnoÅ›ci</h2>
<pre class="codehilite"><code class="language-python">if not (np.real(eigvals[n-1]) &lt; 1e-15 and 
        np.real(eigvals[n]) &gt; -1e-15):
    print(&quot;BÅ‚Ä…d sortowania!&quot;)
    # SprawdÅº sterowalnoÅ›Ä‡
</code></pre>

<p><strong>Warunek:</strong> Ostatnia ujemna &lt; 0, pierwsza dodatnia &gt; 0</p>
<h2>4.5 PodziaÅ‚ wektorÃ³w wÅ‚asnych</h2>
<p>KaÅ¼dy wektor v ma wymiar 2n:</p>
<pre class="codehilite"><code>      [Ï‡â‚]
      [Ï‡â‚‚]
v =   [â‹® ]  â† n elementÃ³w â†’ Ï‡
      [Ï‡â‚™]
      [â”€â”€]
      [Î»â‚]
      [Î»â‚‚]
      [â‹® ]  â† n elementÃ³w â†’ Î»
      [Î»â‚™]
</code></pre>

<p><strong>Kod:</strong></p>
<pre class="codehilite"><code class="language-python">chi = eigvecs[:n, :n]        # GÃ³rne nÃ—n
lambda_mat = eigvecs[n:, :n] # Dolne nÃ—n
</code></pre>

<h2>4.6 RozwiÄ…zanie S</h2>
<p><strong>RÃ³wnanie:</strong> SÂ·Ï‡ = Î»</p>
<p><strong>RozwiÄ…zanie:</strong></p>
<pre class="codehilite"><code class="language-python">S = âˆ’Î»_mat @ np.linalg.inv(Ï‡)
</code></pre>

<h2>4.7 Macierz wzmocnieÅ„ K</h2>
<pre class="codehilite"><code class="language-python">K = np.linalg.inv(r) @ (b.T @ s)
</code></pre>

<pre class="codehilite"><code>K_{mÃ—n} = Râ»Â¹_{mÃ—m} Â· Báµ€_{mÃ—n} Â· S_{nÃ—n}
</code></pre>

<hr />
<h1>CZÄ˜ÅšÄ† 5: SCHEMAT STEROWANIA KROK PO KROKU</h1>
<pre class="codehilite"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INICJALIZACJA                       â”‚
â”‚ x = [0, 0, 0, 0, z0, 0]            â”‚
â”‚ u = [MASS*g/2, MASS*g/2]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PÄ˜TLA GÅÃ“WNA      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. TRAJEKTORIA REFERENCYJNA         â”‚
â”‚                                     â”‚
â”‚ idx = argmin|X_ref_all âˆ’ x_ref|    â”‚
â”‚ z_ref = Z_ref_all[idx]             â”‚
â”‚ alfa = alpha_all[idx]              â”‚
â”‚ Vx_ref = VelÂ·cos(alfa)             â”‚
â”‚ Vz_ref = VelÂ·sin(alfa)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. TRANSFORMACJA DO UKÅADU CIAÅA    â”‚
â”‚                                     â”‚
â”‚ vx_ref = cos(Î¸)Â·Vx + sin(Î¸)Â·Vz    â”‚
â”‚ vz_ref = âˆ’sin(Î¸)Â·Vx + cos(Î¸)Â·Vz   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. OBLICZENIE BÅÄ˜DÃ“W                â”‚
â”‚                                     â”‚
â”‚ e[0] = x[0] âˆ’ vx_ref               â”‚
â”‚ e[1] = x[1] âˆ’ vz_ref               â”‚
â”‚ e[2] = x[2] âˆ’ 0                    â”‚
â”‚ e[3] = x[3] âˆ’ x_ref                â”‚
â”‚ e[4] = x[4] âˆ’ z_ref                â”‚
â”‚ e[5] = x[5] âˆ’ 0                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LINEARYZACJA                     â”‚
â”‚                                     â”‚
â”‚ A, B = aa_matrices_AB(x, t, u)     â”‚
â”‚                                     â”‚
â”‚ Î´ = 10â»â¶                           â”‚
â”‚ A[:,j] = (f(x+Î´eâ±¼)âˆ’f(x))/Î´        â”‚
â”‚ B[:,j] = (f(x,u+Î´eâ±¼)âˆ’f(x,u))/Î´    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. MACIERZE WAG                     â”‚
â”‚                                     â”‚
â”‚ Q = diag([5, 5, 0.1, 1, 50, 1])   â”‚
â”‚ R = eye(2)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ROZWIÄ„ZANIE LQR                  â”‚
â”‚                                     â”‚
â”‚ K, S = lqr_m(A, B, Q, R)           â”‚
â”‚                                     â”‚
â”‚ Algorytm:                          â”‚
â”‚ â€¢ H = [[A,BRâ»Â¹Báµ€],[Q,âˆ’Aáµ€]]        â”‚
â”‚ â€¢ Î», v = eig(H)                    â”‚
â”‚ â€¢ Sortuj Î» (ujemne pierwsze)       â”‚
â”‚ â€¢ Ï‡ = v[:n,:n], Î» = v[n:,:n]      â”‚
â”‚ â€¢ S = Î»Â·Ï‡â»Â¹                        â”‚
â”‚ â€¢ K = Râ»Â¹Báµ€S                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. STEROWANIE                       â”‚
â”‚                                     â”‚
â”‚ u_pert = âˆ’K @ e                    â”‚
â”‚ T1 = T_baseline + u_pert[0]        â”‚
â”‚ T2 = T_baseline + u_pert[1]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. SATURACJA                        â”‚
â”‚                                     â”‚
â”‚ T1 = clip(T1, T_min, T_max)        â”‚
â”‚ T2 = clip(T2, T_min, T_max)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. INTEGRACJA                       â”‚
â”‚                                     â”‚
â”‚ x_new = aa_rk45(x, t, dt, u)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        (nastÄ™pna iteracja)
</code></pre>

<hr />
<h1>CZÄ˜ÅšÄ† 6: PRZYKÅAD NUMERYCZNY</h1>
<h2>6.1 Dane wejÅ›ciowe</h2>
<pre class="codehilite"><code>x = [0.1, âˆ’0.05, 0.02, 5.0, 3.0, 0.1]
u = [122.5, 122.5]
</code></pre>

<h2>6.2 Macierz A (przykÅ‚adowe elementy)</h2>
<pre class="codehilite"><code>A[0,0] â‰ˆ âˆ’10.0    (wpÅ‚yw vx na dvx/dt)
A[0,2] =  0.05    (wpÅ‚yw Ï‰ na dvx/dt = âˆ’vz)
A[1,0] =  0.02    (wpÅ‚yw vx na dvz/dt = +Ï‰)
A[3,0] â‰ˆ  0.995   (wpÅ‚yw vx na dX/dt = cos(Î¸))
</code></pre>

<h2>6.3 Macierz B</h2>
<pre class="codehilite"><code>B[1,0] = âˆ’0.04    (wpÅ‚yw Tâ‚ na dvz/dt)
B[2,0] = âˆ’0.32    (wpÅ‚yw Tâ‚ na dÏ‰/dt)
B[2,1] = +0.32    (wpÅ‚yw Tâ‚‚ na dÏ‰/dt)
</code></pre>

<h2>6.4 WartoÅ›ci wÅ‚asne H</h2>
<pre class="codehilite"><code>Î»â‚ = âˆ’8.23 âˆ’ 1.45i
Î»â‚‚ = âˆ’8.23 + 1.45i
Î»â‚ƒ = âˆ’5.12
Î»â‚„ = âˆ’2.87
Î»â‚… = âˆ’0.92 âˆ’ 0.31i
Î»â‚† = âˆ’0.92 + 0.31i
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Î»â‚‡ = +0.92 + 0.31i
Î»â‚ˆ = +0.92 âˆ’ 0.31i
...
</code></pre>

<h2>6.5 Macierz K (przykÅ‚ad)</h2>
<pre class="codehilite"><code>K â‰ˆ [âˆ’0.65  âˆ’2.91  âˆ’2.85   0.12  âˆ’1.03  âˆ’5.82]
    [âˆ’0.65  âˆ’2.91  +2.85   0.12  âˆ’1.03  âˆ’5.82]
</code></pre>

<h2>6.6 Obliczenie sterowania</h2>
<pre class="codehilite"><code>e = [0.05, âˆ’0.02, 0.01, 0.5, 0.2, 0.05]

u_pert = âˆ’K @ e â‰ˆ [0.44, 0.38]

Tâ‚ = 122.5 + 0.44 = 122.94 N
Tâ‚‚ = 122.5 + 0.38 = 122.88 N
</code></pre>

<hr />
<h1>CZÄ˜ÅšÄ† 7: STROJENIE PARAMETRÃ“W</h1>
<h2>7.1 Macierz Q (wagi stanu)</h2>
<pre class="codehilite"><code class="language-python">Q[0,0] = 5.0    # vx - Å›rednia waga
Q[1,1] = 5.0    # vz - Å›rednia waga
Q[2,2] = 0.1    # Ï‰  - niska (szybkie obroty OK)
Q[3,3] = 1.0    # X  - niska
Q[4,4] = 50.0   # Z  - NAJWYÅ»SZA (priorytet!)
Q[5,5] = 1.0    # Î¸  - niska
</code></pre>

<h2>7.2 PorÃ³wnanie z MATLAB</h2>
<table>
<thead>
<tr>
<th>Stan</th>
<th>TwÃ³j kod</th>
<th>MATLAB</th>
<th>Stosunek</th>
</tr>
</thead>
<tbody>
<tr>
<td>vx</td>
<td>5</td>
<td>1000</td>
<td>200Ã—</td>
</tr>
<tr>
<td>vz</td>
<td>5</td>
<td>1000</td>
<td>200Ã—</td>
</tr>
<tr>
<td>Ï‰</td>
<td>0.1</td>
<td>0.1</td>
<td>1Ã—</td>
</tr>
<tr>
<td>X</td>
<td>1</td>
<td>10</td>
<td>10Ã—</td>
</tr>
<tr>
<td>Z</td>
<td>50</td>
<td>100</td>
<td>2Ã—</td>
</tr>
<tr>
<td>Î¸</td>
<td>1</td>
<td>1000</td>
<td>1000Ã—</td>
</tr>
</tbody>
</table>
<p><strong>Twoje wzmocnienia sÄ… znacznie sÅ‚absze!</strong></p>
<h2>7.3 Zalecenia</h2>
<h3>JeÅ›li dron oscyluje:</h3>
<pre class="codehilite"><code class="language-python">Q[4,4] = 100.0   # ZwiÄ™ksz wagÄ™ Z
Q[5,5] = 100.0   # ZwiÄ™ksz wagÄ™ Î¸
R = eye(2) * 0.1 # Zmniejsz koszt sterowania
</code></pre>

<h3>JeÅ›li dron reaguje wolno:</h3>
<pre class="codehilite"><code class="language-python">Q[0,0] = 100.0   # ZwiÄ™ksz wagÄ™ vx
Q[1,1] = 100.0   # ZwiÄ™ksz wagÄ™ vz
</code></pre>

<h3>JeÅ›li sterowania za duÅ¼e:</h3>
<pre class="codehilite"><code class="language-python">R = eye(2) * 10.0  # ZwiÄ™ksz koszt sterowania
</code></pre>

<hr />
<h1>CZÄ˜ÅšÄ† 8: WERYFIKACJA</h1>
<h2>8.1 Test rÃ³wnowagi</h2>
<pre class="codehilite"><code class="language-python">python rhs.py
</code></pre>

<p><strong>Sprawdza:</strong> Czy dron w poziomie z T=G pozostaje w miejscu?</p>
<p><strong>Oczekiwane:</strong></p>
<pre class="codehilite"><code>dvx/dt â‰ˆ 0
dvz/dt â‰ˆ 0
dÏ‰/dt â‰ˆ 0
</code></pre>

<h2>8.2 Test sterowalnoÅ›ci</h2>
<pre class="codehilite"><code>C = [B | AB | AÂ²B | ... | AâµB]

rank(C) = n â†’ ukÅ‚ad sterowalny
</code></pre>

<h2>8.3 Test stabilnoÅ›ci</h2>
<pre class="codehilite"><code>Î»_closed = eig(A âˆ’ BÂ·K)

Wszystkie Re(Î») &lt; 0 â†’ stabilny
</code></pre>

<hr />
<h1>PODSUMOWANIE</h1>
<h2>Co dziaÅ‚a w Twoim kodzie:</h2>
<p>âœ… Model fizyczny poprawny (body frame + Coriolis)<br />
âœ… Linearyzacja numeryczna dziaÅ‚a<br />
âœ… Algorytm LQR matematycznie poprawny<br />
âœ… Implementacja zgodna z MATLAB  </p>
<h2>Do poprawy:</h2>
<p>âš ï¸ Wzmocnienia Q zbyt sÅ‚abe (20-1000Ã— mniejsze niÅ¼ MATLAB)<br />
âš ï¸ MoÅ¼e powodowaÄ‡ wolnÄ… lub niestabilnÄ… odpowiedÅº  </p>
<h2>Zalecenia:</h2>
<ol>
<li>ZwiÄ™ksz wagi Q do poziomÃ³w MATLAB</li>
<li>Testuj z rÃ³Å¼nymi trajektoriami</li>
<li>Obserwuj wartoÅ›ci wÅ‚asne ukÅ‚adu zamkniÄ™tego</li>
<li>Eksperymentuj z R</li>
</ol>
<hr />
<p><strong>TwÃ³j kod jest matematycznie i fizycznie poprawny!</strong> ğŸ‰</p>
<p>Dokumentacja stworzono: 2025</p>
</body>
</html>
